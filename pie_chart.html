<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å„åŒºå¿äº¤é€šäº‹æ•…æ­»äº¡äººæ•°å æ¯”</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <style>
        #pie-chart {
            width: 100%;
            height: 600px;
        }
        .nav-link {
            text-align: center;
            margin: 20px;
        }
        a {
            color: #4ECDC4;
            text-decoration: none;
            font-size: 16px;
        }
        .year-selector {
            text-align: center;
            margin: 20px 0;
        }
        select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #4ECDC4;
            background: white;
        }
    </style>
</head>
<body>
    <h2>æƒ å·å¸‚å„åŒºå¿äº¤é€šäº‹æ•…æ­»äº¡äººæ•°å æ¯”</h2>
    <div class="nav-link">
        <a href="huizhou_forecast.html">ğŸ‘‰ æŸ¥çœ‹æœªæ¥é¢„æµ‹</a>
        <a href="main_chart.html">ğŸ‘ˆ æŸ¥çœ‹è¶‹åŠ¿åˆ†æ</a>
        <a href="huizhou_economic_forecast.html">ğŸ‘‰ æŸ¥çœ‹ç»æµæŸå¤±é¢„æµ‹</a>
    </div>
    <div class="year-selector">
        <select id="yearSelect">
            <!-- å¹´ä»½é€‰é¡¹ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </select>
    </div>
    <div id="pie-chart"></div>

    <script>
        // 1. åŠ è½½æ•°æ®å¹¶åˆå§‹åŒ–
        fetch('data/huizhou_traffic_2016.json')
            .then(response => response.json())
            .then(data => {
                // 2. åŠ¨æ€ç”Ÿæˆå¹´ä»½é€‰æ‹©å™¨
                const years = [...new Set(data.map(d => d.å¹´ä»½))].sort();
                const yearSelect = document.getElementById('yearSelect');
                years.forEach(year => {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = `${year}å¹´`;
                    yearSelect.appendChild(option);
                });

                // 3. åˆå§‹åŒ–é»˜è®¤æ˜¾ç¤ºæœ€æ–°å¹´ä»½
                let selectedYear = years[years.length - 1];
                updatePieChart(selectedYear);

                // 4. ç›‘å¬å¹´ä»½é€‰æ‹©å˜åŒ–
                yearSelect.addEventListener('change', (e) => {
                    selectedYear = parseInt(e.target.value);
                    updatePieChart(selectedYear);
                });

                // 5. æ›´æ–°é¥¼å›¾å‡½æ•°
                function updatePieChart(year) {
                    const yearData = data.find(d => d.å¹´ä»½ === year);
                    const pieData = [
                        { name: 'æƒ åŸåŒº', value: yearData.æƒ åŸåŒºæ­»äº¡äººæ•°_å æ¯” || 0 },
                        { name: 'æƒ é˜³åŒº', value: yearData.æƒ é˜³åŒºæ­»äº¡äººæ•°_å æ¯” || 0 },
                        { name: 'é¾™é—¨å¿', value: yearData.é¾™é—¨å¿æ­»äº¡äººæ•°_å æ¯” || 0 },
                        { name: 'æƒ ä¸œå¿', value: yearData.æƒ ä¸œå¿æ­»äº¡äººæ•°_å æ¯” || 0 },
                        { name: 'åšç½—å¿', value: yearData.åšç½—å¿æ­»äº¡äººæ•°_å æ¯” || 0 },
                        { name: 'å¤§äºšæ¹¾åŒº', value: yearData.å¤§äºšæ¹¾åŒºæ­»äº¡äººæ•°_å æ¯” || 0 },
                        { name: 'ä»²æºé«˜æ–°åŒº', value: yearData.ä»²æºé«˜æ–°åŒºæ­»äº¡äººæ•°_å æ¯” || 0 }
                    ];

                    // 6. é…ç½®é¥¼å›¾
                    const pieChart = echarts.init(document.getElementById('pie-chart'));
                    const pieOption = {
                        title: {
                            text: `${year}å¹´å„åŒºå¿æ­»äº¡äººæ•°å æ¯”`,
                            left: 'center',
                            textStyle: { fontSize: 18 }
                        },
                        tooltip: {
                            trigger: 'item',
                            formatter: '{b}: {d}%'  // æ˜¾ç¤ºç™¾åˆ†æ¯”
                        },
                        legend: {
                            orient: 'vertical',
                            left: 'left',
                            data: pieData.map(d => d.name),
                            textStyle: { fontSize: 14 }
                        },
                        series: [{
                            type: 'pie',
                            radius: '60%',
                            data: pieData,
                            label: {
                                show: true,
                                formatter: '{b}: {d}%',
                                fontSize: 12
                            },
                            itemStyle: {
                                // é¢œè‰²ä¸ä¸»å›¾è¡¨ä¸€è‡´
                                color: (params) => ({
                                    'æƒ åŸåŒº': '#6C5B7B',
                                    'æƒ é˜³åŒº': '#355C7D',
                                    'é¾™é—¨å¿': '#C06C84',
                                    'æƒ ä¸œå¿': '#F8B195',
                                    'åšç½—å¿': '#99B898',
                                    'å¤§äºšæ¹¾åŒº': '#2A363B',
                                    'ä»²æºé«˜æ–°åŒº': '#E84A5F'
                                }[params.name])
                            }
                        }]
                    };
                    pieChart.setOption(pieOption);
                    window.addEventListener('resize', () => pieChart.resize());
                }
            })
            .catch(error => {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            });
    </script>
</body>
</html>