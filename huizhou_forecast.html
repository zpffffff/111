<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº¤é€šäº‹æ•…æ­»äº¡äººæ•°é¢„æµ‹</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <style>
        #forecast-chart {
            width: 100%;
            height: 600px;
        }
        .nav-link {
            text-align: center;
            margin: 20px;
        }
        a {
            color: #4ECDC4;
            text-decoration: none;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h2>æƒ å·å¸‚äº¤é€šäº‹æ•…æ­»äº¡äººæ•°é¢„æµ‹ï¼ˆ2025-2030ï¼‰</h2>
    <div class="nav-link">
        <a href="main_chart.html">ğŸ‘ˆ è¿”å›è¶‹åŠ¿åˆ†æ</a>
        <a href="pie_chart.html">ğŸ‘ˆ æŸ¥çœ‹å æ¯”åˆ†æ</a>
        <a href="huizhou_economic_forecast.html">ğŸ‘‰ æŸ¥çœ‹ç»æµæŸå¤±é¢„æµ‹</a>
    </div>
    <div id="forecast-chart"></div>

    <script>
// åŒæ—¶åŠ è½½å†å²æ•°æ®å’Œé¢„æµ‹æ•°æ®
Promise.all([
    fetch('data/huizhou_traffic_2016.json').then(res => res.json()),
    fetch('data/huizhou_forecast.json').then(res => res.json())
]).then(([historyData, forecastData]) => {
    // ğŸš€ ç¡®ä¿é¢„æµ‹æ•°æ®ä¸åŒ…å« 2024ï¼Œä»¥å…é‡å¤
    forecastData = forecastData.filter(d => d.å¹´ä»½ >= 2025);

    // åˆå¹¶æ•°æ®
    let allData = [...historyData, ...forecastData];

    // ğŸš€ æŒ‰å¹´ä»½æ’åºï¼ˆç¡®ä¿æ•°æ®æ˜¯ 2016-2030 é¡ºåºï¼‰
    allData.sort((a, b) => a.å¹´ä»½ - b.å¹´ä»½);

    // æå–æ•°æ®
    const allYears = allData.map(d => d.å¹´ä»½);
    const allDeaths = allData.map(d => d.å…¨å¸‚æ­»äº¡äººæ•° ?? d.é¢„æµ‹æ­»äº¡äººæ•° ?? null);
    const allLowerBounds = allData.map(d => d.é¢„æµ‹ä¸‹é™ ?? null);
    const allUpperBounds = allData.map(d => d.é¢„æµ‹ä¸Šé™ ?? null);

    // å†å²æ•°æ®é•¿åº¦
    const historyLength = historyData.length;
    const lastHistoryDeath = allDeaths[historyLength - 1];  // 2024å¹´çš„æ­»äº¡äººæ•°
    const allDeathsFixed = [
        ...allDeaths.slice(0, historyLength),  // å†å²æ•°æ®
        lastHistoryDeath,  //  è®©2024å¹´å’Œ2025å¹´è¿æ¥
        ...allDeaths.slice(historyLength)  // é¢„æµ‹æ•°æ®
    ];
    // åˆå§‹åŒ– ECharts
    const chart = echarts.init(document.getElementById('forecast-chart'));
    const option = {
        tooltip: { trigger: 'axis' },
        legend: { 
            data: ['å†å²æ•°æ®', 'é¢„æµ‹æ•°æ®'],
            selected: {
                'é¢„æµ‹æ•°æ®': false  // åˆå§‹æ—¶éšè—é¢„æµ‹æ•°æ®
            }
        },
        xAxis: {
            type: 'category',
            data: allYears,
            axisLabel: { rotate: 45 }
        },
        yAxis: { type: 'value', name: 'æ­»äº¡äººæ•°' },
        series: [
            {
                name: 'å†å²æ•°æ®',
                type: 'line',
                data: allDeaths.slice(0, historyLength), // ğŸš€ ç¡®ä¿å†å²æ•°æ®æ˜¯ 2016-2024
                itemStyle: { color: '#4ECDC4' },
                lineStyle: { width: 2 }
            },
            {
                name: 'é¢„æµ‹æ•°æ®',
                type: 'line',
                data: allDeathsFixed,// ğŸš€ 2025-2030
                itemStyle: { color: '#FF6B6B' },
                lineStyle: { type: 'dashed', width: 2, opacity: 0 },  // åˆå§‹æ—¶éšè—
                symbol: 'triangle',
                symbolSize: 10
            },
            {
                name: 'é¢„æµ‹æ­»äº¡äººæ•°',
                type: 'line',
                data: [...new Array(historyLength).fill(null), ...allLowerBounds.slice(historyLength)],
                lineStyle: { opacity: 0 },
                showSymbol: false,
                stack: 'confidence',
                areaStyle: { color: 'rgba(255, 107, 107, 0.2)', opacity: 0 }  // åˆå§‹æ—¶éšè—
            },
            {
                name: 'é¢„æµ‹åŒºé—´',
                type: 'line',
                data: [...new Array(historyLength).fill(null), ...allUpperBounds.slice(historyLength)],
                lineStyle: { opacity: 0 },
                showSymbol: false,
                stack: 'confidence',
                areaStyle: { color: 'rgba(255, 107, 107, 0.2)', opacity: 0 }  // åˆå§‹æ—¶éšè—
            }
        ]
    };
    chart.setOption(option);

    // ç›‘å¬ legendselectchanged äº‹ä»¶
    chart.on('legendselectchanged', function (params) {
        if (params.name === 'é¢„æµ‹æ•°æ®') {
            const isSelected = params.selected['é¢„æµ‹æ•°æ®'];
            const series = option.series;
            series[1].lineStyle.opacity = isSelected ? 1 : 0;  // æ˜¾ç¤ºæˆ–éšè—é¢„æµ‹æ•°æ®
            series[2].areaStyle.opacity = isSelected ? 0.2 : 0;  // æ˜¾ç¤ºæˆ–éšè—é¢„æµ‹åŒºé—´
            series[3].areaStyle.opacity = isSelected ? 0.2 : 0;  // æ˜¾ç¤ºæˆ–éšè—é¢„æµ‹åŒºé—´
            chart.setOption({ series: series });
        }
    });

    window.addEventListener('resize', () => chart.resize());
});

    </script>
</body>
</html>